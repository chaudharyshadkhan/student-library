<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Receipt Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0; padding: 20px;
  }
  #storeInputSection, #receiptSection {
    max-width: 600px;
    margin: auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  #storeNameDisplay, #receiptStoreName {
    text-transform: uppercase;
  }

  #receiptSection {
    display: none;
  }
  h1, h2 {
    text-align: center;
    color: #333;
  }
  label {
    font-weight: bold;
  }
  input[type=text], input[type=number] {
    width: 100%;
    padding: 8px;
    margin-top: 8px;
    margin-bottom: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 16px;
  }
  button {
    background: #007bff;
    color: white;
    padding: 12px;
    width: 100%;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #0056b3;
  }
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 12px;
  }
  th {
    background: #007bff;
    color: white;
    padding: 10px;
    border-radius: 8px;
    text-align: left;
  }
  td {
    background: #f9faff;
    padding: 8px;
    border-radius: 8px;
  }
  td input {
    width: 100%;
    border: 1px solid #aaa;
    border-radius: 6px;
    padding: 6px;
    font-size: 16px;
  }
  #addItemBtn {
    background: #28a745;
    margin-top: 15px;
  }
  #addItemBtn:hover {
    background: #1e7e34;
  }
  #totalAmount {
    text-align: right;
    font-size: 22px;
    margin-top: 20px;
    font-weight: bold;
    color: #222;
  }
  .actions {
    display: flex;
    gap: 15px;
    margin-top: 20px;
  }
  .actions button {
    flex: 1;
  }
  #receiptPrintArea {
    max-width: 400px;
    margin: 30px auto 0;
    background: white;
    padding: 20px;
    border-radius: 10px;
    font-family: monospace;
    color: black;
  }
  #receiptPrintArea h2, #receiptPrintArea p {
    text-align: center;
    margin: 5px 0;
  }
  #receiptPrintArea table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  #receiptPrintArea th, #receiptPrintArea td {
    border-bottom: 1px solid #ddd;
    padding: 6px 4px;
  }
  #receiptPrintArea th {
    text-align: left;
  }
  #receiptPrintArea td:nth-child(2),
  #receiptPrintArea td:nth-child(3),
  #receiptPrintArea td:nth-child(4) {
    text-align: right;
  }
  #receiptPrintArea h3 {
    text-align: right;
    margin-top: 10px;
  }
  #receiptPrintArea .thanks {
    text-align: center;
    margin-top: 15px;
    font-style: italic;
    font-weight: 600;
  }
  #qrCodePrint {
    text-align: center;
    margin-top: 15px;
  }
  @media print {
  body * {
    visibility: hidden;
  }
  #receiptPrintArea, #receiptPrintArea * {
    visibility: visible;
  }
  #receiptPrintArea {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    margin: 0;
    box-shadow: none;
    border-radius: 0;
    padding: 0 10px;
    display: block !important;   /* <- Ye add karo */
  }
}

  footer {
    position: relative;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: #222;
    color: white;
    padding: 10px;
    text-align: center;
    font-size: 14px;
    box-sizing: border-box;
  }
</style>
</head>
<body>

<div id="storeInputSection" role="main" aria-label="Store Name Input Section">
  <h1>Enter Your Store Name</h1>
  <label for="storeNameInput">Store Name:</label>
  <input type="text" id="storeNameInput" placeholder="Enter your store name here" aria-required="true" aria-label="Store Name" />
  <button id="enterStoreBtn" aria-label="Enter Store Name">Enter</button>
</div>

<div id="receiptSection" role="main" aria-label="Receipt Section">
  <h2 id="storeNameDisplay"></h2>

  <table aria-label="Items Table">
    <thead>
      <tr>
        <th>Item Name</th>
        <th style="width:80px;">Quantity <br>(in KG)</th>
        <th style="width:100px;">Price (₹)</th>
        <th style="width:100px;">Total (₹)</th>
      </tr>
    </thead>
    <tbody id="itemsTableBody">
      <tr>
        <td><input type="text" class="itemName" placeholder="Item 1" aria-label="Item Name" /></td>
        <td><input type="number" class="itemQty" min="0" placeholder="" aria-label="Quantity" /></td>
        <td><input type="number" class="itemPrice" min="0" step="0.01" placeholder="" aria-label="Price" /></td>
        <td class="itemTotal">0.00</td>
      </tr>
    </tbody>
  </table>

  <button id="addItemBtn">Add Item</button>

  <div id="totalAmount">Total Amount: ₹0.00</div>

  <div class="actions">
    <button id="printBtn">Print Receipt</button>
    <button id="downloadPdfBtn" style="background:#28a745;">Download PDF</button>
    <button id="newReceiptBtn" style="background:#dc3545;">New Receipt</button>
  </div>
</div>

<!-- Printable Receipt -->
<div id="receiptPrintArea" aria-label="Printable Receipt" style="display:none;">
  <h2 id="receiptStoreName"></h2>
  <p id="receiptDate"></p>
  <p id="receiptTime"></p>
  <hr />
  <table>
    <thead>
      <tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>
    </thead>
    <tbody id="receiptItemsBody"></tbody>
  </table>
  <hr />
  <h3>Total: ₹<span id="receiptTotalAmount">0.00</span></h3>
  <div id="qrCodePrint"></div>
  <p class="thanks">Thank you for your purchase!</p>
</div>

<div>
  <a href="index.html"><button>Back</button></a>
</div>

<footer>
  <p>&copy; 2025 -CHAUDHARY SHAD KHAN | Last Updated: <span id="lastUpdated"></span></p>
  <p>Maintained by: CHAUDHARY SHAD KHAN</p>
</footer>

<!-- QRCode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const now = new Date();
  document.getElementById("lastUpdated").textContent = now.toLocaleDateString() + " " + now.toLocaleTimeString();

  const storeInputSection = document.getElementById('storeInputSection');
  const receiptSection = document.getElementById('receiptSection');
  const storeNameInput = document.getElementById('storeNameInput');
  const enterStoreBtn = document.getElementById('enterStoreBtn');
  const storeNameDisplay = document.getElementById('storeNameDisplay');

  const itemsTableBody = document.getElementById('itemsTableBody');
  const addItemBtn = document.getElementById('addItemBtn');
  const totalAmountDiv = document.getElementById('totalAmount');

  const printBtn = document.getElementById('printBtn');
  const newReceiptBtn = document.getElementById('newReceiptBtn');
  const downloadPdfBtn = document.getElementById('downloadPdfBtn');

  const receiptPrintArea = document.getElementById('receiptPrintArea');
  const receiptStoreName = document.getElementById('receiptStoreName');
  const receiptDate = document.getElementById('receiptDate');
  const receiptTime = document.getElementById('receiptTime');
  const receiptItemsBody = document.getElementById('receiptItemsBody');
  const receiptTotalAmount = document.getElementById('receiptTotalAmount');
  const qrCodePrint = document.getElementById('qrCodePrint');

  // Enter store name & show receipt UI
  enterStoreBtn.addEventListener('click', () => {
    const name = storeNameInput.value.trim();
    if (!name) {
      alert('Please enter your store name');
      return;
    }
    storeNameDisplay.textContent = name.toUpperCase();
    storeInputSection.style.display = 'none';
    receiptSection.style.display = 'block';
    storeNameInput.value = '';
    updateTotals();
  });

  // Add item row
  addItemBtn.addEventListener('click', () => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" class="itemName" placeholder="Item" aria-label="Item Name" /></td>
      <td><input type="number" class="itemQty" min="0" placeholder="" aria-label="Quantity" /></td>
      <td><input type="number" class="itemPrice" min="0" step="0.01" placeholder="" aria-label="Price" /></td>
      <td class="itemTotal">0.00</td>
    `;
    itemsTableBody.appendChild(tr);
    attachListeners(tr);
  });

  // Attach listeners to inputs in row for realtime total calculation and Enter key navigation
  function attachListeners(tr) {
    const qtyInput = tr.querySelector('.itemQty');
    const priceInput = tr.querySelector('.itemPrice');
    const nameInput = tr.querySelector('.itemName');
    const totalCell = tr.querySelector('.itemTotal');

    function recalc() {
      const qty = parseFloat(qtyInput.value) || 0;
      const price = parseFloat(priceInput.value) || 0;
      const total = qty * price;
      totalCell.textContent = total.toFixed(2);
      updateTotals();
    }

    qtyInput.addEventListener('input', recalc);
    priceInput.addEventListener('input', recalc);

    // Handle Enter key to move focus to next input field smartly
    [nameInput, qtyInput, priceInput].forEach((input, idx, arr) => {
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          // Move to next input in same row, or add new row if last input
          if (idx < arr.length - 1) {
            arr[idx + 1].focus();
          } else {
            // If last input (price), move to next row's first input or add row
            const currentRow = input.closest('tr');
            let nextRow = currentRow.nextElementSibling;
            if (nextRow) {
              nextRow.querySelector('.itemName').focus();
            } else {
              addItemBtn.click();
              // Wait a bit for new row to be added then focus
              setTimeout(() => {
                const lastRow = itemsTableBody.lastElementChild;
                lastRow.querySelector('.itemName').focus();
              }, 50);
            }
          }
        }
      });
    });

    recalc();
  }

  // Initialize listeners for initial row
  itemsTableBody.querySelectorAll('tr').forEach(attachListeners);

  // Update grand total
  function updateTotals() {
    let grandTotal = 0;
    document.querySelectorAll('.itemTotal').forEach(td => {
      grandTotal += parseFloat(td.textContent) || 0;
    });
    totalAmountDiv.textContent = `Total Amount: ₹${grandTotal.toFixed(2)}`;
  }

  // Get current date and time formatted
  function getCurrentDateTime() {
    const now = new Date();
    const date = now.toLocaleDateString();
    const time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    return { date, time };
  }

  // Generate QR code data string (JSON)
  function generateQRData(storeName, items) {
    return JSON.stringify({
      storeName,
      items,
      generatedAt: new Date().toISOString()
    });
  }

  // Generate receipt content for print and PDF
  function generateReceiptContent() {
    const storeName = storeNameDisplay.textContent;
    const {date, time} = getCurrentDateTime();

    receiptStoreName.textContent = storeName;
    receiptDate.textContent = `Date: ${date}`;
    receiptTime.textContent = `Time: ${time}`;

    receiptItemsBody.innerHTML = '';

    const items = [];
    document.querySelectorAll('#itemsTableBody tr').forEach(row => {
      const name = row.querySelector('.itemName').value.trim() || '-';
      const qty = parseFloat(row.querySelector('.itemQty').value) || 0;
      const price = parseFloat(row.querySelector('.itemPrice').value) || 0;
      const total = qty * price;
      items.push({name, qty, price});

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${name}</td>
        <td style="text-align:center;">${qty}</td>
        <td style="text-align:right;">₹${price.toFixed(2)}</td>
        <td style="text-align:right;">₹${total.toFixed(2)}</td>
      `;
      receiptItemsBody.appendChild(tr);
    });

    const grandTotal = items.reduce((acc, item) => acc + item.qty * item.price, 0);
    receiptTotalAmount.textContent = grandTotal.toFixed(2);

    // Generate QR code
    qrCodePrint.innerHTML = '';
    new QRCode(qrCodePrint, {
      text: generateQRData(storeName, items),
      width: 130,
      height: 130,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });

    return {items, storeName, date, time, grandTotal};
  }

  // Print button action
  printBtn.addEventListener('click', () => {
    generateReceiptContent();
    window.print();
  });

  // New Receipt resets form
  newReceiptBtn.addEventListener('click', () => {
    itemsTableBody.innerHTML = `
      <tr>
        <td><input type="text" class="itemName" placeholder="Item 1" aria-label="Item Name" /></td>
        <td><input type="number" class="itemQty" min="0" placeholder="" aria-label="Quantity" /></td>
        <td><input type="number" class="itemPrice" min="0" step="0.01" placeholder="" aria-label="Price" /></td>
        <td class="itemTotal">0.00</td>
      </tr>
    `;
    attachListeners(itemsTableBody.querySelector('tr'));
    updateTotals();
  });

  // Download PDF button action
  downloadPdfBtn.addEventListener('click', () => {
    generateReceiptContent();
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
      unit: 'pt',
      format: [400, 600]
    });

    doc.html(receiptPrintArea, {
      callback: function(doc) {
        doc.save('receipt.pdf');
      },
      x: 10,
      y: 10,
      width: 380
    });
  });
</script>

</body>
</html>
